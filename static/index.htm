<html>
<head>
<title>Hello jQuery</title>
<!-- DataTables CSS -->
<link rel="stylesheet" type="text/css"
	href="//cdn.datatables.net/1.10.0/css/jquery.dataTables.css">

<link href="cantine.css" rel="stylesheet" type="text/css" />
<!-- jQuery -->
<script type="text/javascript" charset="utf8"
	src="//code.jquery.com/jquery-1.10.2.min.js"></script>

<!-- DataTables -->
<script type="text/javascript" charset="utf8"
	src="//cdn.datatables.net/1.10.0/js/jquery.dataTables.js"></script>
<script>
	var semaine;
	var plats;
	$(document).ready(function() {
		$.ajax({
			url : "/menu"
		}).then(function(data) {
			plats=data.plats;
			semaine = data.semaine;
			$('.semaine').append(data.semaine);
			// 			$.each(data.plats, function(key, value) { 
			// 				$('.plats').append(key + ' -> ' + value + '<br>');
			// 			});

			$('.table').dataTable({
				"data" : data.plats,
				"columns" : [ {
					"title" : ""
				}, {
					"title" : data.plats[0][1]
				}, {
					"title" : data.plats[0][2]
				}, {
					"title" : data.plats[0][3]
				}, {
					"title" : data.plats[0][4]
				}, {
					"title" : data.plats[0][5]
				} ]
			});

						var table = $('.table').DataTable();
			$('.table tbody').on('click', 'td', function() {
				console.debug("ligne"+table.cell(this).index().row+ " column "+table.cell(this).index().column);
				if ($(this).hasClass('cell_selected')) {
					$(this).removeClass('cell_selected');
// 					$.each(table.cells( ".cell_selected" ).data(), function(key,value) { 
// 						alert(value);
// 									});
					
					
				} else {
					$(this).addClass('cell_selected');
// 					$.each(table.cells( ".cell_selected" ).data(), function(key,value) { 
// 						alert(value);
// 									});
				}
			});


		});

	});

	function email() {
		var sBody;
		var table = $('.table').DataTable();
		cells = table.cells( ".cell_selected" );
		var platsMail = [];
		for (var i = 1; i < 6; i++) { 
			platsMail[i] = plats[0][i];
		}
		$.each(table.cells( ".cell_selected" )[0], function(key, value) { 
			console.debug("\nNuméro jour "+plats[0][table.cell(this).index().column]+" plat "+table.cell(this).data());
			platsMail[table.cell(this).index().column] = platsMail[table.cell(this).index().column] + " " + table.cell(this).data();
						});
		
		
		sBody = platsMail.join("\n");
		console.debug(sBody);
		var sMailTo = "mailto:";
		sMailTo += escape("alexis.krier@cirso.fr") + "?subject="
				+ escape("choix: " + semaine) + "&body=" + escape(sBody);
		window.location.href = sMailTo;
	}
</script>
</head>
<body>
	<h2>Hello Cantine!</h2>
	<div>
		<p class="semaine"></p>
		<p class="plats">
			The content is <br>
		</p>
		<p>
		<table class="table"></table>
		</p>
	</div>
	<button onClick='email()'>Envoyer</button>
</body>
</html>
